<script type="text/javascript">

	// pageChanged & sizeChanged functions are needed in every model file
	// other functions for model should also be in here to avoid conflicts
	var delicious = new function() {
		var $pageContents,
			$textHolder,
			$panel,
			$resultsHolder,
			deliciousSearch,
			deliciousTerm;

		// function called every time the page is viewed after it has initially loaded
		this.pageChanged = function() {

		};

		// function called every time the size of the LO is changed
		this.sizeChanged = function() {

		};

		this.showLinks = function(data) {
			clearTimeout(x_timer);
			$("#loadingSpinner").hide();

			var resultsString = "";
			$pageContents.find("#headerHolder").html("<p>" + "Delicious bookmarks for " + deliciousSearch + " '" + deliciousTerm + "'</p>"); // ** Need to take this from the language file
			if (data.length == 0) {
				resultsString = '<div><p>No results returned!!</p></div>';  // ** Need to take this from the language file
			} else {
				$.each(data, function (index, value) {
					resultsString += '<div><p><a href="' + value.u + '">' + value.d + '</a></p></div>';
				});
			}
			$resultsHolder
				.html(resultsString)
				.find("div:even").addClass("shadedDiv");
		};

		this.init = function() {
			$pageContents = $("#pageContents");
			$textHolder = $("#textHolder");
			$panel = $("#pageContents .panel");
			$resultsHolder = $pageContents.find("#resultsHolder");
			$("#loadingSpinner p").html("Fetching results..."); // ** Need to take this from the language file

			deliciousSearch = x_currentPageXML.getAttribute("search");
			deliciousTerm = x_currentPageXML.getAttribute("term");
			var deliciousCount = x_currentPageXML.getAttribute("results");

			var deliciousURL;
			if (deliciousSearch == 'popular') {
				deliciousURL = "http://feeds.delicious.com/v2/json/popular/" + encodeURI(deliciousTerm);
			} else if (deliciousSearch == 'user'){
				deliciousURL = "http://feeds.delicious.com/v2/json/" + encodeURI(deliciousTerm);
			} else { //recent - default
				//deliciousSearch = 'tag';
				deliciousURL = "http://feeds.delicious.com/v2/json/tag/" + encodeURI(deliciousTerm);
			}

			$.ajax({
				beforeSend: function() {
					x_timer = setTimeout(function() {
					 	$("#loadingSpinner").show();
					 	$resultsHolder
					 		.html('<div><p>There was an error loading the results!!</p></div>') // ** Need to take this from the language file
					 		.find("div:even").addClass("shadedDiv");
					}, 5000);
				},
				url: deliciousURL,
				data: {count : deliciousCount},
				dataType: 'jsonp',
				jsonpCallback: "delicious.showLinks",
				cache: false
			});

			$panel.addClass("x_floatRight");
			$panel.addClass("width60");

			$textHolder.html(x_addLineBreaks(x_currentPageXML.getAttribute("text")));

			// call this function in every model once everything's loaded
			x_pageLoaded();
		}
	};

	delicious.init();

</script>

<style type="text/css">

	#headerHolder {
		text-align:		center;
		font-weight:	bold;
	}

	#resultsHolder {
		width:	100%;
	}

	#resultsHolder div {
		width: 100%;
		padding: 2px 2px 2px 2px;

	}

	#resultsHolder div p {
		margin: 0;
	}

	.shadedDiv {
		background-color: #E3FFD6;
	}

	#loadingSpinner {
		margin-left: auto ;
  		margin-right: auto ;
		width:180px;
	}

	.spinner {
		float:left;
		margin:-8px 20px 0 0;
	}

	#loadingSpinner p {
		font-weight:	bold;
	}

</style>

<div id="pageContents">

	<div id="deliciousHolder" class="mobileAlign"> <!-- this tag is only used when viewed on mobiles to change layout -->
		<div class="panel inline">
			<div id="loadingSpinner"><div class="spinner"></div><p></p></div>
			<div id="headerHolder"></div>
			<div id="resultsHolder"></div>

		</div>
	</div>

	<div id="textHolder">

	</div>

</div>